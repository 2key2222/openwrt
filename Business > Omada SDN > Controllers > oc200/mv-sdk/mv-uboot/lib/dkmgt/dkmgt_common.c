/*! Copyright (c) TP-LINK TECHNOLOGIES CO., LTD.
 *
 *@file     dkmgt_utils.c
 *@brief    utils for all apps.
 *@details  
 *
 *@author   Gan Guoheng <ganguoheng@tp-link.net>
 *@version  1.0.0
 *@date     10Nov15
 *
 *@warning  
 *
 *@history  1.0.0, 10Nov15, Gan Guoheng, Create the file.
 */

/**************************************************************************************************/
/*                                       CONFIGURATIONS                                           */
/**************************************************************************************************/

/**************************************************************************************************/
/*                                       INCLUDE_FILES                                            */
/**************************************************************************************************/
#include <common.h>
#include <stdlib.h>
#include <linux/ctype.h>

#include "thirdparty/cJSON/cJSON.h"

#include "dkmgt_file.h"
#include "dkmgt_common.h"

/**************************************************************************************************/
/*                                       DEFINES                                                  */
/**************************************************************************************************/

/**************************************************************************************************/
/*                                       TYPES                                                    */
/**************************************************************************************************/

/**************************************************************************************************/
/*                                       EXTERN_PROTOTYPES                                        */
/**************************************************************************************************/

/**************************************************************************************************/
/*                                       LOCAL_PROTOTYPES                                         */
/**************************************************************************************************/

/**************************************************************************************************/
/*                                       VARIABLES                                                */
/**************************************************************************************************/

/**************************************************************************************************/
/*                                       LOCAL_FUNCTIONS                                          */
/**************************************************************************************************/


/**************************************************************************************************/
/*                                       PUBLIC_FUNCTIONS                                         */
/**************************************************************************************************/

/* WARNING: the 'json_data' *MAY* not have a terminator. */
cJSON* dkmgt_parse_json_data(char * json_data, int json_len) {
    cJSON * json_root = NULL;
    char* json_text = NULL;

    json_text = malloc(json_len + 1); /* add a terminator buffer. */
    if (NULL == json_text) {
        DOUT_ERROR("Faield to alloc %d bytes memory.", json_len + 1);
        goto error;
    }

    memset(json_text, 0, json_len);
    memcpy(json_text, json_data, json_len);
    json_text[json_len] = '\0';

    json_root = cJSON_Parse(json_text);
    if (NULL == json_root) {
        DOUT_ERROR("Failed to parse <%p,%d>'", json_data, json_len);
        goto error;
    }

    if (NULL != json_text) {
        free(json_text);
    }

    return json_root;

error:

    if (NULL != json_text) {
        free(json_text);
    }

    if (NULL != json_root) {
        cJSON_Delete(json_root);
    }

    return NULL;
}


/**************************************************************************************************/
/*                                       GLOBAL_FUNCTIONS                                         */
/**************************************************************************************************/


