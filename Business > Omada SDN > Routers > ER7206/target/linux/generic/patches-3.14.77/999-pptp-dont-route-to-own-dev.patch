--- a/drivers/net/ppp/pptp.c	2017-10-19 15:08:07.406924557 +0800
+++ b/drivers/net/ppp/pptp.c	2017-10-19 15:08:37.625207115 +0800
@@ -268,6 +268,11 @@
 		goto tx_error;
 
 	tdev = rt->dst.dev;
+	pptp_ifindex = ppp_dev_index(chan);
+	/* can't route to own dev */
+	if (tdev->ifindex == pptp_ifindex) {
+		goto tx_error;
+	}
 
 	max_headroom = LL_RESERVED_SPACE(tdev) + sizeof(*iph) + sizeof(*hdr) + 2;
 
@@ -354,8 +359,6 @@
 	ip_select_ident(skb, NULL);
 	ip_send_check(iph);
 
-	pptp_ifindex = ppp_dev_index(chan);
-
 	/* set incoming interface as the ppp interface */
 	if (skb->skb_iif)
 		skb->skb_iif = pptp_ifindex;
