From 2d718b42ebc530be270398406ff9c1ec9bd082bd Mon Sep 17 00:00:00 2001
From: Yelena Krivosheev <yelena@marvell.com>
Date: Thu, 30 Mar 2017 13:21:53 +0200
Subject: [PATCH 1577/2241] fix: phy: marvell: no link PHY speed, duplex set to
 UNKNOWN

Change-Id: I4a9d7686b942a4bb8c1fad39d8eb5df7aa92f4f5
Signed-off-by: Yelena Krivosheev <yelena@marvell.com>
Reviewed-on: http://vgitil04.il.marvell.com:8080/38223
Tested-by: iSoC Platform CI <ykjenk@marvell.com>
Reviewed-by: Dmitri Epshtein <dima@marvell.com>
Reviewed-by: Stefan Chulski <stefanc@marvell.com>
Reviewed-by: Neta Zur Hershkovits <neta@marvell.com>
---
 drivers/net/phy/marvell.c | 5 ++++-
 1 file changed, 4 insertions(+), 1 deletion(-)

diff --git a/drivers/net/phy/marvell.c b/drivers/net/phy/marvell.c
index 140e4a6..6b624b4 100644
--- a/drivers/net/phy/marvell.c
+++ b/drivers/net/phy/marvell.c
@@ -1253,7 +1253,10 @@ static int marvell_read_status(struct phy_device *phydev)
 		phydev->asym_pause = 0;
 		phydev->lp_advertising = 0;
 	}
-
+	if (!phydev->link) {
+		phydev->speed = SPEED_UNKNOWN;
+		phydev->duplex = DUPLEX_UNKNOWN;
+	}
 	return 0;
 }
 
-- 
2.7.4

