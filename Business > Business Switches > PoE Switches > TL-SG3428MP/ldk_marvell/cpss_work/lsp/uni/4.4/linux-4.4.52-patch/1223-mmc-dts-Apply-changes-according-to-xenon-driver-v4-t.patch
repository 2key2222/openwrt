From 10786481b0704c01899e18bdb9884a551eac7ee3 Mon Sep 17 00:00:00 2001
From: Konstantin Porotchkin <kostap@marvell.com>
Date: Thu, 22 Dec 2016 16:52:25 +0200
Subject: [PATCH 1223/2241] mmc: dts: Apply changes according to xenon driver
 v4 to DTS

Update DTS files of platfoms using xenon MMC unit according
to changes introduced by the mainline driver v4 backport.

Change-Id: If104f2eb59e33a506b68410223ad42282302d1b1
Signed-off-by: Konstantin Porotchkin <kostap@marvell.com>
Reviewed-on: http://vgitil04.il.marvell.com:8080/34942
Reviewed-by: Omri Itach <omrii@marvell.com>
Tested-by: iSoC Platform CI <ykjenk@marvell.com>
Reviewed-by: Hanna Hawa <hannah@marvell.com>
---
 arch/arm64/boot/dts/marvell/armada-3720-community.dts |  1 +
 arch/arm64/boot/dts/marvell/armada-3720-db.dts        |  8 ++++++--
 arch/arm64/boot/dts/marvell/armada-37x0-customer.dts  |  5 +++--
 arch/arm64/boot/dts/marvell/armada-37xx.dtsi          | 12 ++++++------
 arch/arm64/boot/dts/marvell/armada-7040-db.dtsi       |  3 +++
 arch/arm64/boot/dts/marvell/armada-8040-db.dtsi       |  4 ++++
 arch/arm64/boot/dts/marvell/armada-8040-mcbin.dts     |  5 ++++-
 arch/arm64/boot/dts/marvell/armada-ap806.dtsi         |  7 +++----
 arch/arm64/boot/dts/marvell/armada-cp110.dtsi         |  3 +--
 9 files changed, 31 insertions(+), 17 deletions(-)

diff --git a/arch/arm64/boot/dts/marvell/armada-3720-community.dts b/arch/arm64/boot/dts/marvell/armada-3720-community.dts
index a3f7099..33f92ab 100644
--- a/arch/arm64/boot/dts/marvell/armada-3720-community.dts
+++ b/arch/arm64/boot/dts/marvell/armada-3720-community.dts
@@ -116,6 +116,7 @@
 				bus-width = <4>;
 				cd-gpios = <&gpio_nb 3 GPIO_ACTIVE_LOW>;
 				no-1-8-v;
+				marvell,pad-type = "sd";
 				status = "okay";
 
 				pinctrl-names = "default";
diff --git a/arch/arm64/boot/dts/marvell/armada-3720-db.dts b/arch/arm64/boot/dts/marvell/armada-3720-db.dts
index 52bfe3f..296ba39 100644
--- a/arch/arm64/boot/dts/marvell/armada-3720-db.dts
+++ b/arch/arm64/boot/dts/marvell/armada-3720-db.dts
@@ -156,6 +156,7 @@
 				bus-width = <4>;
 				cd-gpios = <&gpio_sb 2 GPIO_ACTIVE_LOW>;
 				vqmmc-supply = <&vcc_sd_reg1>;
+				marvell,pad-type = "sd";
 				status = "okay";
 
 				pinctrl-names = "default";
@@ -163,10 +164,13 @@
 			};
 
 			sdhci0: sdhci@d8000 {
-				xenon,fixed-1-8v-pad-ctrl;
+				marvell,pad-type = "fixed-1-8v";
 				non-removable;
 				bus-width = <8>;
-				tuning-count = <9>;
+				mmc-ddr-1_8v;
+				mmc-hs400-1_8v;
+				marvell,xenon-emmc;
+				marvell,xenon-tun-count = <9>;
 				status = "okay";
 
 				pinctrl-names = "default";
diff --git a/arch/arm64/boot/dts/marvell/armada-37x0-customer.dts b/arch/arm64/boot/dts/marvell/armada-37x0-customer.dts
index f0f6600..0fbfd95 100644
--- a/arch/arm64/boot/dts/marvell/armada-37x0-customer.dts
+++ b/arch/arm64/boot/dts/marvell/armada-37x0-customer.dts
@@ -197,6 +197,7 @@
 				bus-width = <4>;
 				cd-gpios = <&gpio_sb 2 GPIO_ACTIVE_LOW>;
 				vqmmc-supply = <&vcc_sd_reg1>;
+				marvell,pad-type = "sd";
 				status = "disabled";
 				/* UPDATE */
 				pinctrl-names = "default";
@@ -204,10 +205,10 @@
 			};
 
 			sdhci0: sdhci@d8000 {
-				xenon,fixed-1-8v-pad-ctrl;
+				marvell,pad-type = "fixed-1-8v";
+				marvell,xenon-tun-count = <9>;
 				non-removable;
 				bus-width = <8>;
-				tuning-count = <9>;
 				status = "disabled";
 				/* UPDATE */
 				pinctrl-names = "default";
diff --git a/arch/arm64/boot/dts/marvell/armada-37xx.dtsi b/arch/arm64/boot/dts/marvell/armada-37xx.dtsi
index af5f188..392b11b 100644
--- a/arch/arm64/boot/dts/marvell/armada-37xx.dtsi
+++ b/arch/arm64/boot/dts/marvell/armada-37xx.dtsi
@@ -331,22 +331,22 @@
 
 
 			sdhci1: sdhci@d0000 {
-				compatible = "marvell,xenon-sdhci";
+				compatible = "marvell,armada-3700-sdhci",
+					     "marvell,sdhci-xenon";
 				reg = <0xd0000 0x300>,
 				      <0x1e808 0x4>;
 				interrupts = <GIC_SPI 25 IRQ_TYPE_LEVEL_HIGH>;
-				xenon,slotno = <0>;
 				clock-names = "core";
 				clocks = <&core_clk 7>;
 				status = "disabled";
 			};
 
 			sdhci0: sdhci@d8000 {
-				compatible = "marvell,xenon-sdhci";
-				reg = <0xd8000 0x300>,
-				      <0x17808 0x4>;
+				compatible = "marvell,armada-3700-sdhci",
+					     "marvell,sdhci-xenon";
+				reg = <0xd8000 0x300
+				       0x17808 0x4>;
 				interrupts = <GIC_SPI 26 IRQ_TYPE_LEVEL_HIGH>;
-				xenon,slotno = <0>;
 				clock-names = "core";
 				clocks = <&core_clk 7>;
 				status = "disabled";
diff --git a/arch/arm64/boot/dts/marvell/armada-7040-db.dtsi b/arch/arm64/boot/dts/marvell/armada-7040-db.dtsi
index ce56f2f..ffc8dc7 100644
--- a/arch/arm64/boot/dts/marvell/armada-7040-db.dtsi
+++ b/arch/arm64/boot/dts/marvell/armada-7040-db.dtsi
@@ -109,7 +109,10 @@
 				usb-phy = <&usb3h1_phy>;
 			};
 			sdhci@780000 {
+				bus-width = <4>;
+				no-1-8-v;
 				non-removable;
+				marvell,pad-type = "sd";
 			};
 			spi@700680 {
 				spi-flash@0 {
diff --git a/arch/arm64/boot/dts/marvell/armada-8040-db.dtsi b/arch/arm64/boot/dts/marvell/armada-8040-db.dtsi
index 2af9f52..ea4ac2e 100644
--- a/arch/arm64/boot/dts/marvell/armada-8040-db.dtsi
+++ b/arch/arm64/boot/dts/marvell/armada-8040-db.dtsi
@@ -59,6 +59,7 @@
 	ap806 {
 		config-space {
 			sdhci@6e0000 {
+				marvell,xenon-emmc;
 				bus-width = <8>;
 				non-removable;
 			};
@@ -116,6 +117,9 @@
 			};
 			sdhci@780000 {
 				bus-width = <4>;
+				no-1-8-v;
+				non-removable;
+				marvell,pad-type = "sd";
 				non-removable;
 			};
 		};
diff --git a/arch/arm64/boot/dts/marvell/armada-8040-mcbin.dts b/arch/arm64/boot/dts/marvell/armada-8040-mcbin.dts
index d3598fa..54b1a92 100644
--- a/arch/arm64/boot/dts/marvell/armada-8040-mcbin.dts
+++ b/arch/arm64/boot/dts/marvell/armada-8040-mcbin.dts
@@ -71,7 +71,8 @@
 				bus-width = <8>;
 				no-1-8-v;
 				non-removable;
-				xenon,phy-slow-mode;
+				marvell,xenon-emmc;
+				marvell,pad-type = "fixed-1-8v";
 				status = "okay";
 			};
 			vccq_mmc_reg: regulator@0 {
@@ -100,7 +101,9 @@
 			sdhci@780000 {
 				vqmmc-supply = <&vccq_sdio_reg>;
 				bus-width = <4>;
+				no-1-8-v;
 				broken-cd;
+				marvell,pad-type = "sd";
 				pinctrl-names = "default";
 				pinctrl-0 = <&cpm_sdhci_pins>;
 				status = "okay";
diff --git a/arch/arm64/boot/dts/marvell/armada-ap806.dtsi b/arch/arm64/boot/dts/marvell/armada-ap806.dtsi
index 325e596..62ad775 100644
--- a/arch/arm64/boot/dts/marvell/armada-ap806.dtsi
+++ b/arch/arm64/boot/dts/marvell/armada-ap806.dtsi
@@ -341,17 +341,16 @@
 			};
 			/* The SDIO should not be enabled in Z1 DSTI/DST */
 			sdhci@6e0000 {
-				compatible = "marvell,xenon-sdhci";
-				reg = <0x6E0000 0x300>;
+				compatible = "marvell,armada8k-sdhci";
+				reg = <0x6e0000 0x300>;
 				interrupts = <GIC_SPI 16 IRQ_TYPE_LEVEL_HIGH>;
 				clock-names = "core";
 				clocks = <&syscon 4>;
-				xenon,slotno = <0>;
 				/*
 				 * The AP SDIO interface should work in PHY slow mode
 				 * and clock not higher than 50MHz due to HW limitation
 				 */
-				xenon,phy-slow-mode;
+				marvell,xenon-phy-slow-mode;
 				max-frequency = <50000000>;
 				dma-coherent;
 				status = "disabled";
diff --git a/arch/arm64/boot/dts/marvell/armada-cp110.dtsi b/arch/arm64/boot/dts/marvell/armada-cp110.dtsi
index abef02d..bead961 100644
--- a/arch/arm64/boot/dts/marvell/armada-cp110.dtsi
+++ b/arch/arm64/boot/dts/marvell/armada-cp110.dtsi
@@ -298,12 +298,11 @@ mdio@15b000 {
 };
 
 sdhci@780000 {
-	compatible = "marvell,xenon-sdhci";
+	compatible = "marvell,armada8k-sdhci";
 	reg = <0x780000 0x300>;
 	interrupts = <ICU_GRP_NSR 27 IRQ_TYPE_LEVEL_HIGH>;
 	clock-names = "core";
 	clocks = <&cpm_syscon0 1 4>;
-	xenon,slotno = <0>;
 	dma-coherent;
 	status = "disabled";
 };
-- 
2.7.4

