From 52557117532c7b63c6f8cccbd618ad66c8e84689 Mon Sep 17 00:00:00 2001
From: Evan Wang <xswang@marvell.com>
Date: Tue, 8 Aug 2017 16:08:27 +0800
Subject: [PATCH 1898/2241] dts: mcbin: pcie: add phandle of pcie reset gpio

MCbin board needs PCIe reset, this patch adds phandle
to reset the PCIe.

Change-Id: Iec455931db766cb8a8b541ab7fedcbd1c6bc7395
Signed-off-by: Evan Wang <xswang@marvell.com>
Reviewed-on: http://vgitil04.il.marvell.com:8080/42744
Reviewed-by: Igal Liberman <igall@marvell.com>
Tested-by: iSoC Platform CI <ykjenk@marvell.com>
Reviewed-by: Hanna Hawa <hannah@marvell.com>
---
 arch/arm64/boot/dts/marvell/armada-8040-mcbin-pp2-vanilla.dts | 7 +++++++
 arch/arm64/boot/dts/marvell/armada-8040-mcbin.dts             | 7 +++++++
 2 files changed, 14 insertions(+)

diff --git a/arch/arm64/boot/dts/marvell/armada-8040-mcbin-pp2-vanilla.dts b/arch/arm64/boot/dts/marvell/armada-8040-mcbin-pp2-vanilla.dts
index 56aa640..820e5b6 100644
--- a/arch/arm64/boot/dts/marvell/armada-8040-mcbin-pp2-vanilla.dts
+++ b/arch/arm64/boot/dts/marvell/armada-8040-mcbin-pp2-vanilla.dts
@@ -95,6 +95,10 @@
 					marvell,pins = "mpp47";
 					marvell,function = "gpio";
 				};
+				pcie_reset_pins: pcie-reset-pins {
+					marvell,pins = "mpp52";
+					marvell,function = "gpio";
+				};
 			};
 			comphy0: comphy {
 				status = "disabled";
@@ -211,6 +215,9 @@
 				&comphy0 3 COMPHY_PCIE0
 				>;
 			phy-names = "pcie-phy0", "pcie-phy1", "pcie-phy2", "pcie-phy3";
+			reset-gpios = <&cpm_gpio1 20 GPIO_ACTIVE_HIGH>;
+			pinctrl-names = "default";
+			pinctrl-0 = <&pcie_reset_pins>;
 		};
 		reg_usb3h0_vbus: usb3-vbus0 {
 			compatible = "regulator-fixed";
diff --git a/arch/arm64/boot/dts/marvell/armada-8040-mcbin.dts b/arch/arm64/boot/dts/marvell/armada-8040-mcbin.dts
index 431c00a..2d1ddef 100644
--- a/arch/arm64/boot/dts/marvell/armada-8040-mcbin.dts
+++ b/arch/arm64/boot/dts/marvell/armada-8040-mcbin.dts
@@ -94,6 +94,10 @@
 					marvell,pins = "mpp47";
 					marvell,function = "gpio";
 				};
+				pcie_reset_pins: pcie-reset-pins {
+					marvell,pins = "mpp52";
+					marvell,function = "gpio";
+				};
 			};
 			comphy0: comphy {
 				status = "okay";
@@ -172,6 +176,9 @@
 				&comphy0 3 COMPHY_PCIE0
 				>;
 			phy-names = "pcie-phy0", "pcie-phy1", "pcie-phy2", "pcie-phy3";
+			reset-gpios = <&cpm_gpio1 20 GPIO_ACTIVE_HIGH>;
+			pinctrl-names = "default";
+			pinctrl-0 = <&pcie_reset_pins>;
 		};
 		reg_usb3h0_vbus: usb3-vbus0 {
 			compatible = "regulator-fixed";
-- 
2.7.4

